var app;init();function init(){var b=["javascript/libraries/jquery-1.7.1.min.js","javascript/libraries/jquery-ui-1.8.17.custom.min.js","javascript/libraries/jquery.mousewheel.js","javascript/libraries/jquery.event.drag-2.0.js","javascript/libraries/date.format.js","javascript/libraries/spin.min.js"];yepnope({load:b,complete:a});function a(d,c,e){app=new Application();app.init()}}function Application(){var a=this;var g;function f(){g=new Editor();g.init();g.start();$(document).keydown(b);d();window.addEventListener("online",e);window.addEventListener("offline",c);if(!navigator.onLine){$(".toggle-button").hide()}}function b(h){var i=h.which;g.keyDown(h,i)}function d(){if(Modernizr.touch){var h="";h+='<article class="browser-warning">';h+="<strong>Not Optimized for Touch Input</strong>";h+=" You are using a touch enabled device. Please be aware that this application is not yet optimized for touch input";h+="</div>";$("body").prepend(h)}}function c(h){$(".toggle-button").fadeOut();$("#file-upload").removeClass("active");$(".upload-info.info-container-active").removeClass(".info-container-active")}function e(h){$(".toggle-button").fadeIn();if($(".block").not(".preview").length){$("#file-upload").addClass("active")}}a.init=f}function Canvas(){var n=this;var f=false;var Z={};var l=getBlockSize();var p=[];var t={x:0,y:0,target:{x:0,y:0}};var o;var b=getColors();var H=b[0];var b;var j={width:1,depth:1};var c=true;var k=false;var Y={};function W(aa){Z=aa;$("body").click(C).mousemove(s).bind("dragstart",K).bind("drag",V).bind("dragend",I).append('<div id="cursor"></div>').append('<div id="blocks"></div>');z();J()}function D(){if(!f){f=true;$("#blocks").addClass("blocks-active");if(!o){o="single";Z.navigation.showInfo("single");$("#cursor").show();if(!$(".block.preview").length){z()}}}}function u(){if(f){f=false;$("#blocks").removeClass("blocks-active");$("#cursor").hide()}}function P(){E({blocks:$(".block")})}function C(aa){if(f){if(!$(aa.target).is("nav")&&!$(aa.target).closest("nav").length&&!$(aa.target).is(".help")&&!$(aa.target).closest(".help").length&&!$(aa.target).is(".gallery-toggle")&&!$(aa.target).closest(".gallery-toggle").length){if(c&&(o==="single"||o==="multiple")){i();L();z();J()}if(o==="delete"){O(aa)}}}}function s(aa){if(f){if(aa.pageY<$(window).height()-$("nav").height()){t.target.x=M(aa.pageX,aa.pageY).x;t.target.y=M(aa.pageX,aa.pageY).y;c=true;m();J();if(o==="single"||o==="multiple"){$("#cursor").show();if(!$(".block.preview").length){z()}$("#blocks").removeClass("no-preview")}else{$("#cursor").hide();if($(".block.preview").length){E($(".block.preview"))}$("#blocks").addClass("no-preview")}}else{c=false;$("#cursor").hide();if($(".block.preview").length){B()}$("#blocks").addClass("no-preview")}if(aa.shiftKey){k=true;if(o==="single"&&c&&$(".block.preview").length){i()}}else{shift_pressed=false}}}function K(aa,ac){if(f){Y={};if(k&&o==="delete"){$("body").append('<div id="selection"></div>');var ab={width:ac.deltaX,height:ac.deltaY,left:ac.startX,top:ac.startY};if(ac.deltaX<0){ab.width=ac.deltaX;ab.left=ac.startX+ac.deltaX}if(ac.deltaY<0){ab.height=ac.deltaY;ab.top=ac.startY+ac.deltaY}$("#selection").css(ab)}}if(aa){k=aa.shiftKey}}function V(ab,af){if(f){k=ab.shiftKey;if(o==="single"&&c){if(!$(".block.preview").length){z()}var ae=$("#cursor").position();if(Y.top!==ae.top&&Y.left!==ae.left){i();Y=ae}}if(k&&o==="delete"){var ad={width:af.deltaX,height:af.deltaY,left:af.startX,top:af.startY};if(af.deltaX<0){ad.width=af.deltaX*-1;ad.left=af.startX+af.deltaX}if(af.deltaY<0){ad.height=af.deltaY*-1;ad.top=af.startY+af.deltaY}var ac=p.length;while(ac--){var ag=$("#block-"+p[ac].index);if(ag.length){var aa=ag.position();if(aa.left>=ad.left&&aa.left+l.width<=ad.left+ad.width&&aa.top>=ad.top&&aa.top+l.height<=ad.top+ad.height){ag.addClass("selected")}else{ag.removeClass("selected")}}}$("#selection").css(ad)}}}function I(aa){if(f){if(o==="delete"){$("#selection").remove()}k=false}}function m(){if(f){if(t.x!=t.target.x||t.y!=t.target.y){t.x+=parseInt(t.target.x-t.x);t.y+=parseInt(t.target.y-t.y)}var aa={top:t.y+(l.height/2),left:t.x-(l.height/2)};$("#cursor").css(aa)}}function L(aa){function ae(aj,ai){var ah=(aj.position.x+(aj.position.y*p.length)+(aj.position.z*p.length*p.length));var ag=(ai.position.x+(ai.position.y*p.length)+(ai.position.z*p.length*p.length));var af=ah-ag;return af}var ad=aa||p;ad.sort(ae);var ab=p.length;while(ab--){var ac=ad[ab];ac.z_index=ab+ac.position.z;$("#block-"+ac.index).css({zIndex:ab})}}function U(aa){if(f){var ac=aa||"solid";var ad={index:parseInt(S()+1),color:H,position:{x:t.x,y:t.y,z:T(t.x,t.y)},type:aa};var ab='<div class="block color-'+ad.color+'" id="block-'+ad.index+'"></div>';var ae={top:ad.position.y+(-l.height*ad.position.z),left:ad.position.x};p.push(ad);$("#blocks").append(ab);$("#block-"+ad.index).css(ae);if(aa==="preview"){$("#block-"+ad.index).addClass("preview")}A()}}function E(aa){if(f){if(aa){if(aa.index){var ac=[];var ab=p.length;while(ab--){if(p[ab].index===aa.index){if(p[ab].type!=="preview"){ac.push(p[ab])}p.splice(ab,1);$("#block-"+p[ab].index).remove();break}}if(ac.length){Z.history.save({action:"remove",blocks:ac})}}if(aa.blocks){$(aa.blocks).each(function(){var af=[];var ae=R($(this));var ad=p.length;while(ad--){if(p[ad].index==ae){if(p[ad].type!=="preview"){af.push(p[ad])}$("#block-"+ae).remove();p.splice(ad,1);break}}if(af.length){Z.history.save({action:"remove",blocks:af})}})}if(aa.position){var ac=[];var ab=p.length;while(ab--){if(p[ab].position.x===aa.position.x&&p[ab].position.y===aa.position.y&&p[ab].position.z===aa.position.z){if(p[ab].type!=="preview"){ac.push(p[ab])}$("#block-"+p[ab].index).remove();p.splice(ab,1);break}}if(ac.length){Z.history.save({action:"remove",blocks:ac})}}}A()}}function e(){E({blocks:$(".selected")})}function O(aa){if(f){var ab=$(aa.target);if(ab.hasClass("block")){ab.toggleClass("selected")}}}function J(){if(f){if(o==="single"){a()}if(o==="multiple"){q()}L()}}function B(){E({blocks:$(".block.preview")})}function d(){E({blocks:$(".block")})}function h(){E({blocks:$(".block.color-transparent")})}function a(){var aa={x:t.x,y:t.y,z:T(t.x,t.y)};var ad=R($(".block.preview"));var ac=p.length;while(ac--){if(p[ac].index===ad){p[ac].position=aa;break}}var ab={top:aa.y+(-l.height*aa.z),left:aa.x};$(".block.preview").css(ab)}function q(){if(f){$(".block.preview").each(function(aa,ac){var ab={x:aa%j.depth,y:Math.floor(aa/j.depth)};var ad={x:t.x,y:t.y,z:1};var ag=R($(ac));if(ab.x>0){ad.x+=l.height*ab.x;ad.y+=l.height*ab.x/2}if(ab.y>0){ad.x+=l.height*ab.y;ad.y-=l.height*ab.y/2}ad.z=T(ad.x,ad.y);var af=p.length;while(af--){if(p[af].index===ag){p[af].position=ad;break}}var ae={top:ad.y+(-l.height*ad.z),left:ad.x};$(ac).css(ae)})}}function z(){if(f){if(o==="single"){if($(".block.preview").length>1){E({blocks:$(".block.preview").not(":first")})}if(!$(".block.preview").length){U("preview")}}if(o==="multiple"){if($(".block.preview").length<j.width*j.depth){var ab=j.width*j.depth-$(".block.preview").length;for(var ac=0;ac<ab;ac++){U("preview")}}if($(".block.preview").length>(j.width*j.depth)){var aa=($(".block.preview").length-(j.width*j.depth))-1;E({blocks:$(".block.preview:gt("+aa+")")})}}A()}}function i(){if(f){var aa=[];$(".block.preview").each(function(){var ac=R($(this));$(this).removeClass("preview");var ab=p.length;while(ab--){if(p[ab].index===ac){aa.push(p[ab]);p[ab].type="solid";break}}});if(aa.length){Z.history.save({action:"add",blocks:aa})}A()}}function X(ab,aa){if(f){$(".block.preview").addClass("color-"+ab).removeClass("color-"+aa)}}function x(ab,aa){options=Z.history[ab](aa);if(f){if(options&&options.blocks&&options.action&&options.history_action){if(options.history_action==="undo"){if(options.action==="add"){g(options)}if(options.action==="remove"){r(options)}}if(options.history_action==="redo"){if(options.action==="remove"){g(options)}if(options.action==="add"){r(options)}}}}}function r(aa){if(f){var ae=aa.blocks;var ac=ae.length;while(ac--){var ad=ae[ac];ad.index=parseInt(S()+1);var ab='<div class="block color-'+ad.color+'" id="block-'+ad.index+'"></div>';var af={top:ad.position.y+(-l.height*ad.position.z),left:ad.position.x};p.push(ad);$("#blocks").append(ab);$("#block-"+ad.index).css(af);L();A()}}}function g(aa){if(f){var ae=aa.blocks;var ac=ae.length;while(ac--){var ad=ae[ac];var ab=p.length;while(ab--){if(p[ab].index===ad.index){$("#block-"+ad.index).remove();p.splice(ab,1);L();break}}}}}function M(ad,ac){var ab=(Math.round((ad-l.width)/l.height)*l.height)-l.height;var aa=(Math.round((ac-l.height)/l.height)*l.height);if((ab/l.height)%2==0){aa+=(l.height/2)}return{x:ab,y:aa}}function T(ah,ae,ac){var ag=ac||p;var ab=0;var aa=false;var ad=p.length;while(ad--){var af=ag[ad];if(af.position.x===ah&&af.position.y===ae&&af.type==="solid"&&af.position.z>=ab){ab=af.position.z;aa=true}}if(aa){ab++}return ab}function R(ab){var aa=false;if(ab.attr("id")){aa=parseInt(ab.attr("id").replace("block-",""))}return aa}function S(){var aa=0;var ab=p.length;while(ab--){if(p[ab].index>aa){aa=p[ab].index}}return aa}function Q(aa){if(f){o=aa;z();J();if(o==="delete"){B()}else{$(".block.selected").removeClass("selected")}}}function N(){return o}function v(ab,aa){if(f){X(ab,aa);H=ab;J()}}function F(aa){if(f){j[aa.id]=aa.value;z();J()}}function w(aa){if(f){for(var ac=0;ac<aa.length;ac++){var ae=aa[ac].index;var ad=aa[ac];ad.index=S()+1;var ab='<div class="block color-'+ad.color+'" id="block-'+ad.index+'"></div>';var af={top:ad.position.y+(-l.height*ad.position.z),left:ad.position.x};Z.history.historyUpdateIDs(ae,ad.index);p.push(ad);$("#blocks").append(ab);$("#block-"+ad.index).css(af)}A()}}function A(){if(f){$(".stats .count span").text($(".block:not(.preview)").length);if(!b){b=getColors()}var ab=b.length;while(ab--){var aa=$(".block.color-"+b[ab]+":not(.preview)").length;if(aa){if(!$(".stats .count-color-"+b[ab]).length){$(".stats").prepend('<p class="count-color count-color-'+b[ab]+'"><span></span> '+b[ab]+" blocks</p>")}$(".stats .count-color-"+b[ab]+" span").text(aa)}}}y()}function y(){var aa=false;if(p.length-$(".block.preview").length>0&&p.length<3000&&Z.history.getHistoryLength()<3000&&navigator.onLine){aa=true}if(aa){$("#file-upload").addClass("active")}else{$(".upload-info").removeClass("info-container-active");$("#file-upload").removeClass("active")}}function G(){E({blocks:$(".block.preview"),position:{x:0,y:0,z:0}});return p}n.init=W;n.start=D;n.stop=u;n.clear=P;n.setMode=Q;n.getMode=N;n.colorUpdate=v;n.sizeUpdate=F;n.historyUpdate=x;n.deleteSelected=e;n.getBlocks=G;n.importBlocks=w;n.getBlocks=G;n.previewRemove=B;n.previewUpdateBlocks=z;n.allRemove=d;n.deleteTransparent=h}function Editor(){var f=this;var c={};c.history=new History();c.memory=new Memory();c.navigation=new Navigation();c.canvas=new Canvas();c.help=new Help();var h=false;function i(){window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder;window.URL=window.webkitURL||window.URL;d("init",c)}function a(){if(!h){h=true;d("start");$(".show-gallery").addClass("active");$(".help-button").addClass("help-button-active")}}function g(){if(h){h=false;d("stop");$(".help-button").removeClass("help-button-active")}}function d(k,j){for(name in c){if(c[name][k]){c[name][k](j)}}}f.init=i;f.start=a;f.stop=g;f.keyDown=e;f.getBlockSize=c.canvas.getBlockSize;function e(j,k){if(getNumberKey(k)!==-1){if(!$("input:focus").length){b(j,k)}}else{if(!$("input:focus").length){if(k===8){if(c.canvas.getMode()==="delete"){j.preventDefault();c.canvas.deleteSelected();c.navigation.showInfo(c.canvas.getMode())}}if(j.metaKey||j.ctrlKey){if(k===90||k===122){if(j.shiftKey){j.preventDefault();c.canvas.historyUpdate("redo")}else{j.preventDefault();c.canvas.historyUpdate("undo")}c.navigation.showInfo(c.canvas.getMode())}if(k===111||k===79){j.preventDefault();c.navigation.showInfo("import")}if(k===69||k===101){j.preventDefault();c.navigation.showInfo("export")}if(k===83||k===115){j.preventDefault();c.navigation.showInfo("save")}if(k===65){j.preventDefault();c.canvas.setMode("single");c.navigation.showInfo("single")}if(k===77||k===109){j.preventDefault();c.canvas.setMode("multiple");c.navigation.showInfo("multiple")}if(k===68||k===100){j.preventDefault();c.canvas.setMode("delete");c.navigation.showInfo("delete")}if(k===72){if($("#blocks").hasClass("blocks-active")){j.preventDefault();c.help.toggle()}}}}if(k===13){if($(".export-info").hasClass("info-container-active")){if(!$(".export-info .download-link").length){$(".export-info #export-json").trigger("click")}else{}}if($(".import-info").hasClass("info-container-active")){$(".import-info #import-file").trigger("click")}if($(".save-info").hasClass("info-container-active")){$(".save-info .info-button").trigger("click")}}}}function b(k,l){if(h){k.preventDefault();var j=getNumberKey(l);var m=$(".color-buttons a").eq(j);var n=m.attr("id").replace("color-button-","");$(".color-buttons .active").removeClass("active");m.closest("li").addClass("active");if(c.canvas.getMode()==="delete"){c.canvas.setMode("single");c.navigation.showInfo("single")}else{c.navigation.showInfo(c.canvas.getMode())}c.canvas.colorUpdate(n)}}}function Help(){var g=this;var c;var j;function i(k){c=$(".help");j=$(".help-toggle");j.click(f);$("div > h1",c).click(a);$(window).resize(d);d()}function b(){c.addClass("active")}function h(){c.removeClass("active")}function e(){if(c.hasClass("active")){h()}else{b()}}function f(k){k.preventDefault();c.toggleClass("active")}function a(k){var l=$(k.target);l.closest("div").toggleClass("help-item-active")}function d(l){var k=$(window).height()-$("nav").height()-225;c.find(".help-text").css({"max-height":k})}g.init=i;g.start=b;g.stop=h;g.toggle=e}function stringToSlug(c){c=c.replace(/^\s+|\s+$/g,"");c=c.toLowerCase();var e="àáäâèéëêìíïîòóöôùúüûñç·/_,:;";var d="aaaaeeeeiiiioooouuuunc------";for(var b=0,a=e.length;b<a;b++){c=c.replace(new RegExp(e.charAt(b),"g"),d.charAt(b))}c=c.replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-");return c}function getRandomNumber(d,b,c){var a=Math.random()+(b-d)+d;if(c){a=Math.floor(Math.random()*(b-d+1))+d}return a}function getNumberKey(a){return[49,50,51,52,53,54,55,56,57,48].indexOf(a)}function getColors(){var a=[];$(".color-buttons a").each(function(){var b=$(this).attr("id").replace("color-button-","");a.push(b)});return a}function getBlockSize(){return{width:28,height:14}}function History(){var l=this;var h=[];var e=-1;var c=[];var b={};function q(r){b=r;m()}function k(r){if(e!==h.length&&h.length){h=h.slice(0,e)}h.push({action:r.action,blocks:r.blocks});e=h.length}function n(){var r=false;if(o()){var s=parseInt(e-1);r=h[s];r.history_action="undo";e--}return r}function j(){var r=false;if(a()){var s=e;r=h[s];r.history_action="redo";e++}return r}function a(){var r=false;if(e<h.length){r=true}return r}function o(){var r=false;if(e>0){r=true}return r}function d(){return h}function i(){return h.length}function m(){var r=b.memory.load();if(r&&r.history){p(r.history)}}function p(r){c=r}function g(u,v){for(var t=0;t<c.length;t++){var r=[];if(c[t].blocks){for(var s=0;s<c[t].blocks.length;s++){if(c[t].blocks[s].index===u){c[t].blocks[s].index=v}r.push(c[t].blocks[s])}}if(c[t].block){if(c[t].block.index===u){c[t].block.index=v}r.push(c[t].block)}k({action:"add",blocks:r})}c=[]}function f(){h=[];e=-1}l.init=q;l.save=k;l.undo=n;l.redo=j;l.clear=f;l.hasNext=a;l.hasPrev=o;l.getHistory=d;l.getHistoryLength=i;l.importHistory=p;l.historyUpdateIDs=g}function Memory(){var g=this;var b={};function k(m){b=m}function f(o){var r=o.target.files;var n=[];for(var q=0;q<r.length;q++){var p={name:r[q].name,type:r[q].type,size:r[q].size};n.push(p)}if(n.length&&window.FileReader){var m=new FileReader();m.readAsText(r[0]);m.onload=(function(s){return function(t){a(t.target.result)}})(r[0])}}function a(o){b.canvas.clear();b.history.clear();var n={};try{n=jQuery.parseJSON(o)}catch(m){}if(n&&n.blocks&&n.history){b.canvas.clear();b.history.clear();b.history.importHistory(n.history);b.canvas.importBlocks(n.blocks)}}function j(o){if($("#blocks").length){var m=document.styleSheets[1];var r=$("#blocks").html();var q="";var n=new Date();var s={id:stringToSlug($("#export-sketch").val()),date:n.format("yyyy-mm-dd HH:MM"),name:$("#export-sketch").val()};for(var p=0;p<m.cssRules.length;p++){q+=m.cssRules[p].cssText+"\n"}r="<style>"+q+'</style><div id="blocks">'+r+"</div>";d(o,r,s,"text/html",".html")}}function c(n){if($("#blocks").length){var m=new Date();var p={blocks:b.canvas.getBlocks(),history:b.history.getHistory(),id:stringToSlug($("#export-sketch").val()),date:m.format("yyyy-mm-dd HH:MM"),name:$("#export-sketch").val()};var o="";if(JSON&&JSON.stringify){o=JSON.stringify(p)}d(n,o,p,"application/json",".json")}}function l(n){var m=false;if(JSON&&JSON.stringify&&n.blocks.length<3000&&n.name){var o={data:JSON.stringify(n)};$.ajax({type:"POST",url:"gallery/upload.php?ajax-upload=true",data:o,success:b.navigation.sketchUploadCallback,error:b.navigation.sketchUploadCallback,dataType:"json"})}}function e(){if($("#blocks").length){var n=new Date;var o={blocks:b.canvas.getBlocks(),history:b.history.getHistory(),id:stringToSlug($("#save-sketch").val()),date:n.format("yyyy-mm-dd HH:MM"),name:$("#save-sketch").val()};var m=h()||[];m.push(o);if(Modernizr.localstorage&&JSON&&JSON.stringify){localStorage.setItem("blocks_data",JSON.stringify(m))}}b.navigation.savedToLocal()}function h(){var m=[];if(Modernizr.localstorage){m=jQuery.parseJSON(localStorage.getItem("blocks_data"))}return m}function d(m,s,q,r,t){if(window.BlobBuilder){$(".export-info input, .export-info label, .export-info .info-button").hide();if(!$(".export-info .download-link").length){$(".export-info h1").after('<a class="download-link info-button">Download File</a>')}var v=new BlobBuilder();v.append(s);var n=q.id||"myBlocks";n+=t;var u=window.URL.createObjectURL(v.getBlob(r));var p=$(".export-info .download-link");var o={download:n,href:u,"data-downloadurl":[r,n,u].join(":")};p.attr(o).click(i)}}function i(m){var n=$(m.target);var o=navigator.userAgent.toLowerCase().indexOf("chrome")>-1;if(!o){m.preventDefault();m.stopPropagation();window.open(n.attr("href"))}n.remove();$(".export-info input, .export-info label, .export-info a").show()}g.exportHTML=j;g.exportJSON=c;g.fileImported=f;g.load=h;g.upload=l;g.save=e;g.init=k}var Navigation=function(){var g=this;var n={min:1,max:20,value:1,step:1,slide:c};var k=false;var M={};function J(N){M=N;$(".color-buttons li:first").addClass("active");$(".mode-buttons a:first").addClass("active");i(".multiple-info .size-slider");C("single");$(".color-buttons a").click(L);$(".mode-buttons a").click(x);$(".history-buttons a").click(u);$("#file-export").click(q);$("#file-import").click(j);$("#file-upload").click(e);$("#file-save").click(K);$("#file-load").click(F);$("#delete-selected").click(a);$("#delete-all").click(p);$("#delete-transparent").click(E);$(".save-info a").click(o);$("#export-html").click(I);$("#export-json").click(t);$("#upload").click(b);$(".upload-info input").keyup(v);$("#upload-again, #upload-try-again").click(B);$("#import-file").change(G);$("nav").hover(w,d);var O=$(".color-buttons li.active a").attr("id").replace("color-button-","");if(!Modernizr.localstorage){$("#file-save, #file-load").remove()}if(!window.FileReader){$("#file-import").remove()}if(!window.BlobBuilder||!window.URL){$("#file-export").remove()}$(".upload-inprogress").prepend('<div class="upload-spin"></div>');H($(".upload-spin"));M.canvas.setMode("single");M.canvas.colorUpdate(O)}function m(){$("nav").hide()}function r(){$("nav").show()}function H(N){var O={lines:10,length:2,width:1,radius:3,color:"#000",speed:0.8,trail:30,shadow:false,hwaccel:false,className:"spinner",zIndex:2000000000,top:"10px",left:"10px"};var P=new Spinner(O).spin(N[0])}function L(N){N.preventDefault();var O=M.canvas.getMode();var P=$(N.target).attr("id").replace("color-button-","");$(".color-buttons .active").removeClass("active");$(".color-buttons #color-button-"+P).closest("li").addClass("active");if(O==="delete"){M.canvas.setMode("single");C("single")}else{C(O)}M.canvas.colorUpdate(P)}function x(O){O.preventDefault();var N=$(O.target).attr("id").replace("mode-","");$(".mode-buttons .active").removeClass("active");$(".mode-buttons #mode-"+N).addClass("active");C(N);M.canvas.setMode(N)}function A(N){$(".mode-buttons .active").removeClass("active");$(".mode-buttons #mode-"+N).addClass("active")}function G(N){M.memory.fileImported(N)}function u(N){N.preventDefault();var O=$(N.target).attr("id").replace("history-","");M.canvas.historyUpdate(O)}function a(N){N.preventDefault();M.canvas.deleteSelected()}function p(N){N.preventDefault();var O="";O+='<div class="dialog dialog-remove-all">';O+="<p>Delete all Blocks?</p>";O+='<a href="#" id="dialog-confirm">OK</p>';O+='<a href="#" id="dialog-cancel">Cancel</p>';O+="</div>";$("body").append(O);$(".dialog-remove-all #dialog-confirm").click(z);$(".dialog-remove-all #dialog-cancel").click(h)}function z(N){N.preventDefault();M.canvas.clear();h()}function E(N){N.preventDefault();M.canvas.deleteTransparent()}function h(N){if(N){N.preventDefault()}$(".dialog").remove()}function q(N){N.preventDefault();C("export")}function e(N){N.preventDefault();C("upload")}function v(){if($("#upload-sketch").val().length>3){$("#upload").addClass("active")}else{$("#upload").removeClass("active")}}function b(N){if($("#upload-sketch").val().length>3){var O={};O.name=$(".upload-info #upload-sketch").val();O.author=$(".upload-info #upload-author").val()||undefined;O.email=$(".upload-info #upload-email").val()||undefined;O.website=$(".upload-info #upload-website").val()||undefined;O.twitter=$(".upload-info #upload-twitter").val()||undefined;O.blocks=M.canvas.getBlocks();O.history=M.history.getHistory();M.memory.upload(O);$(".upload-form").addClass("upload-hidden");$(".upload-inprogress").removeClass("upload-hidden")}}function s(N){$(".upload-inprogress").addClass("upload-hidden");if(N.success&&N.messages){$(".upload-success").removeClass("upload-hidden")}else{$(".upload-failed").removeClass("upload-hidden")}}function B(N){N.preventDefault();$(".upload-success, .upload-failed").addClass("upload-hidden");$(".upload-form").removeClass("upload-hidden");v()}function j(N){N.preventDefault();C("import")}function K(N){N.preventDefault();C("save")}function F(N){N.preventDefault();C("load");f()}function I(N){N.preventDefault();M.memory.exportHTML(N)}function t(N){N.preventDefault();M.memory.exportJSON(N)}function o(N){N.preventDefault();if(!k){k=true;$(N.target).text("Saved").addClass("inactive");M.memory.save()}}function C(N){$(".info-container > *").not(".info-"+N).removeClass("info-container-active");$(".info-container ."+N+"-info").addClass("info-container-active");$(".mode-buttons #mode-"+N).addClass("active").parent().siblings().find("a").removeClass("active")}function f(){var P=M.memory.load();var N="";if(P.length){if(!$(".load-info .sketch-list").length){$(".load-info").append('<ul class="sketch-list"></ul>')}for(var O=0;O<P.length;O++){N+='<li id="sketch-'+O+'">';N+='<p class="sketch-name"><a href="#">'+P[O].name+"</a></p>";N+='<p class="sketch-date">'+P[O].date+"</p>";N+="</li>"}$(".load-info .sketch-list").html(N);$(".load-info .sketch-list a").click(D)}}function D(N){var P=$(N.target).closest("li").attr("id").replace("sketch-","");var O=M.memory.load();if(O&&O.length&&O[P]&&O[P].blocks){M.canvas.clear();M.canvas.importBlocks(O[P].blocks)}}function y(){setTimeout(function(){$(".save-info a").text("Save").removeClass("inactive");k=false},1500)}function w(N){M.canvas.previewRemove()}function d(N){M.canvas.previewUpdateBlocks()}function i(N){$(N).each(function(){$(this).append('<div class="nav-slider"></div>');$(this).find(".nav-slider").slider(n);$(this).find("h1").text($(this).text()+": "+n.value);var O=$(this).closest("li").attr("id").replace("size-","");M.canvas.sizeUpdate({id:O,value:n.value})})}function c(N,P){if($(N.target).closest("li").attr("id")){var O=$(N.target).closest("li").attr("id").replace("size-","");$(N.target).closest("li").find("h1").text(O+": "+P.value);M.canvas.sizeUpdate({id:O,value:P.value})}}function l(){var N=[];$(".color-buttons a").each(function(O,P){N.push($(P).attr("id").replace("color-button-",""))});return N}g.init=J;g.stop=m;g.start=r;g.savedToLocal=y;g.showInfo=C;g.setMode=A;g.getColors=l;g.sketchUploadCallback=s};