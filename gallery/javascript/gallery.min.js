function Application(){var b=this;var a;function d(){var f=$.address.pathNames();a=new Gallery();a.init();$(document).keydown(c);$.address.change(e);a.start()}function e(){var f=$.address.pathNames();a.addressChanged(f)}function c(f){var g=f.which;a.keyDown(f,g)}b.init=d}function Gallery(){var i=this;var D=[];var o=[];var r=undefined;var l=undefined;var t=false;var p=true;var a=false;var f=false;var F=false;function x(){window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder;window.URL=window.webkitURL||window.URL;if(!$("#gallery").length){var H='<div id="gallery"></div>';$("body").append(H);$("#gallery-playpause").click(G);if(!window.BlobBuilder){$(".sketch-download").remove()}else{$(".sketch-download a").click(c)}}}function j(){if(!t){t=true;f=true;$("#gallery, .gallery-info").addClass("gallery-active");$(".show-editor").addClass("active")}}function v(){if(t){t=false;f=false;$("#gallery").removeClass("gallery-active").find(".gallery-sketch").remove();$(".gallery-info").removeClass("gallery-active");$(".gallery-toggle").text("Show Gallery")}}function G(H){if(H.preventDefault){H.preventDefault()}if(H!==undefined){if(!H){p=false}else{if(H===true){p=true}else{if(H.target&&!a){var I=$(H.target);if(!I.is("a")){I=I.closest("a");I.find(".active").removeClass("active");p=!p;if(p){I.find(".gallery-play").addClass("active");E()}else{I.find(".gallery-pause").addClass("active")}}}}}}else{p=!p}}function E(){if(p){q()}}function n(H){if(H.length){w(H)}else{E()}}function y(){var H="api/public-api.php?action=get-sketch-ids";$.ajax({url:H,dataType:"json",success:u})}function u(H){o=H;if(t){if(l!==undefined){C(l);l=undefined}else{E()}}}function C(I){if(o.indexOf(I)!==-1&&k(I)!==-1){A(D[o.indexOf(I)])}else{if(o.indexOf(I)!==-1&&k(I)===-1){var H="api/public-api.php?action=get-sketch&value="+I;$.ajax({url:H,dataType:"json",success:A})}}}function A(H){if(k(H.id)===-1){D.push(H)}if(!$(".sketch-"+H.id).length){e(H.id)}if(r!==undefined){var I=function(){m(H.id)};b(r,true,I)}else{m(H.id)}}function m(H){r=H;var I=function(){setTimeout(E,3000)};b(r,false,I)}function w(I){var H=I[I.length-1];if(H){if(o.indexOf(H)!==-1){C(H)}else{if(!o.length){l=H;y()}}}else{if(!o.length){y()}else{E()}}}function q(){if(!o.length){y()}else{var H=o[0];if(r!==undefined){if(o.indexOf(r)!==-1&&o.indexOf(r)<o.length-1){H=o[o.indexOf(r)+1]}}$.address.value(H)}}function e(Q){var K=getBlockSize();var P=k(Q);if(D[P]&&D[P].id&&D[P].blocks){var O=D[P];var N="";var I=g(Q,true);if(!$("#gallery .sketch-"+O.id).length){$("#gallery").append('<div class="gallery-sketch sketch-'+O.id+'"></div>')}for(var M=0;M<O.blocks.length;M++){var L=O.blocks[M];var H='style="';H+="left:"+I[M].left+"px; ";H+="top:"+I[M].top+"px; ";H+='"';var J='<div class="block color-'+L.color+'" id="gallery-sketch-'+Q+"-block-"+L.index+'" '+H+"></div>";N+=J}$("#gallery .sketch-"+O.id).html(N)}}function b(R,O,M){var Q=k(R);var N=D[Q].blocks.length;var P=500;var H=P/N;var I=N/P;var J=g(R,O);var S=D[Q].id;a=true;$("#gallery-playpause").addClass("disabled");$("#gallery-page").text("Sketch "+parseInt(Q+1)+" of "+o.length);if(H>=1){timeout=parseInt(H);I=1}else{P=P/5;H=P/N;I=N/P;timeout=1;I=Math.ceil(I)}if(!O){$("#gallery .sketch-"+S).addClass("active")}else{$(".gallery-info").removeClass("active")}var L={blocks_to_animate:I,timeout:timeout,block_index:0,};function K(T){if(T.blocks_to_animate>1){var V=T.blocks_to_animate;while(V--){var U=T.block_index+V;if(U<D[Q].blocks.length){var W="#gallery-sketch-"+D[Q].id+"-block-"+D[Q].blocks[U].index;$(W).css(J[U])}}}else{$("#gallery #gallery-sketch-"+D[Q].id+"-block-"+D[Q].blocks[T.block_index].index).css(J[T.block_index])}if(t){if(T.block_index<D[Q].blocks.length-1){T.block_index+=T.blocks_to_animate;setTimeout(function(){K(T)},T.timeout)}else{s(R,O,M)}}}K(L)}function s(J,H,I){a=false;$("#gallery-playpause").removeClass("disabled");if(H){$(".sketch-"+J).removeClass("active")}else{r=J;h(D[k(J)])}if(I){setTimeout(I,2000)}}function h(H){var J=H.blocks.length;$(".gallery-info .sketch-blocks").text(J+" blocks").addClass("active");if(H.author){var K="by ";if(H.author){if(H.website){K+='<a href="'+H.website+'">'+H.author+"</a>"}else{K+=H.author}$(".gallery-info .sketch-author").html(K).addClass("active")}}else{$(".gallery-info .sketch-author").text("").removeClass("active")}if(H.name){$(".gallery-info .sketch-name").text(H.name).addClass("active")}else{$(".gallery-info .sketch-name").text("").removeClass("active")}if(H.twitter){$(".gallery-info .sketch-twitter").html('<a href="http://www.twitter.com/'+H.twitter+'">@'+H.twitter+"</a>").addClass("active")}else{$(".gallery-info .sketch-twitter").text("").removeClass("active")}if(H.date){var I="on "+H.date.split(" ")[0];$(".gallery-info .sketch-date").text(I).addClass("active")}else{$(".gallery-info .sketch-date").text("").removeClass("active")}$(".gallery-info ").addClass("active")}function c(H){H.preventDefault();var K=k(r);var J=D[K];var I="api/public-api?action=download-sketch&value="+r;$.ajax({url:I,dataType:"json",success:function(L){var M="";M+='<div class="dialog dialog-download">';M+='<p>Download Sketch "'+J.name+'"</p>';M+='<a href="#" id="dialog-confirm" class="info-button">download</p>';M+="</div>";$("body").append(M);B(JSON.stringify(L),L,"application/json",".json",$("#dialog-confirm"))}})}function d(H){var I=$(H.target);var J=navigator.userAgent.toLowerCase().indexOf("chrome")>-1;if(!J){window.open(I.attr("href"))}$(".dialog-download").remove()}function B(M,J,K,N,L){if(window.BlobBuilder){var P=new BlobBuilder();P.append(M);var H=J.slug||"myBlocks";H+=N;var O=window.URL.createObjectURL(P.getBlob(K));var I={download:H,href:O,"data-downloadurl":[K,H,O].join(":")};L.attr(I).click(d)}}function g(Q,N){var P=[];var H=$(window).width();var R=$(window).height();var J=getBlockSize();var O=k(Q)!==-1?k(Q):0;for(var K=0;K<D[O].blocks.length;K++){var L={};if(N){var M={x:parseInt(getRandomNumber(-1,1,true)),y:parseInt(getRandomNumber(-1,1,true))};L.left=-J.width;L.top=-J.width;if(M.x>0){L.left=(Math.random()*H);if(M.y>0){L.left+=H+J.width*2}}else{L.top=(Math.random()*R);if(M.y<0){L.top+=R+J.width*2}}}else{var I=D[O].blocks[K].position;L.left=I.x;L.top=parseInt(I.y+(-J.height*I.z))}P.push(L)}return P}function k(J){var H=-1;for(var I=0;I<D.length;I++){if(D[I].id===J){H=I;break}}return H}function z(H,I){}i.init=x;i.start=j;i.stop=v;i.addressChanged=n;i.keyDown=z}function stringToSlug(c){c=c.replace(/^\s+|\s+$/g,"");c=c.toLowerCase();var e="àáäâèéëêìíïîòóöôùúüûñç·/_,:;";var d="aaaaeeeeiiiioooouuuunc------";for(var b=0,a=e.length;b<a;b++){c=c.replace(new RegExp(e.charAt(b),"g"),d.charAt(b))}c=c.replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-");return c}function getRandomNumber(d,b,c){var a=Math.random()+(b-d)+d;if(c){a=Math.floor(Math.random()*(b-d+1))+d}return a}function getNumberKey(a){return[49,50,51,52,53,54,55,56,57,48].indexOf(a)}function getColors(){var a=[];$(".color-buttons a").each(function(){var b=$(this).attr("id").replace("color-button-","");a.push(b)});return a}function getBlockSize(){return{width:28,height:14}}var app;init();function init(){var b=["javascript/libraries/jquery-1.7.1.min.js","javascript/libraries/jquery.address-1.4.min.js","javascript/application/gallery.js","javascript/application/application.js","javascript/application/helpers.js"];yepnope({load:b,complete:a});function a(d,c,e){app=new Application();app.init()}};